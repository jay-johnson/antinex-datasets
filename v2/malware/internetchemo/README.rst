Building a Dataset from Recorded Malware 
========================================

This guide is for preparing a dataset to train a deep neural network (dnn) for predicting malware coming in over ssh and telnet. The accuracy is currently **TBD this is a work in progress**. You can tuning your dnn using the `REST API`_:

.. _REST API: https://github.com/jay-johnson/train-ai-with-django-swagger-jwt

Setup
-----

#.  Run these commands to clone the repositories to the same directories for making debugging easier for all users.

    ::

        git clone https://github.com/jay-johnson/train-ai-with-django-swagger-jwt.git ~/train-ai-with-django-swagger-jwt
        git clone https://github.com/jay-johnson/network-pipeline-datasets.git /opt/datasets
        git clone https://github.com/jay-johnson/antinex-datasets.git /opt/antinex-datasets

#.  Start the REST API

    If the REST API is not running, please start it in a new terminal so it can process the prepare and training requests.

    ::

        cd ~/train-ai-with-django-swagger-jwt
        source ~/.venvs/venvdrfpipeline/bin/activate
        ./install.sh
        ./start.sh

(Optional) Prepare Attack Dataset
---------------------------------

If you want to prepare your own attack dataset run these commands with the REST API running locally:

::

    source ~/.venvs/venvdrfpipeline/bin/activate
    ~/train-ai-with-django-swagger-jwt/tests/build-new-dataset.py -f /opt/antinex-datasets/v2/malware/internetchemo/configs/only-prepare-attack.json

Check the files were updated:

::

    ls -l /opt/antinex-datasets/v2/malware/internetchemo/inputs/attack/

(Optional) Prepare Full Dataset
-------------------------------

If you want to prepare your own full dataset run these commands with the REST API running locally:

::

    source ~/.venvs/venvdrfpipeline/bin/activate
    ~/train-ai-with-django-swagger-jwt/tests/build-new-dataset.py -f /opt/antinex-datasets/v2/malware/internetchemo/configs/prepare.json

(Optional) Convert Recordings into a Dataset
--------------------------------------------

If you want to prepare your own dataset from recorded packets stored in csv files (by default in ``/tmp/*.csv``) run these commands with the REST API running locally:

::

    source ~/.venvs/venvdrfpipeline/bin/activate
    ~/train-ai-with-django-swagger-jwt/tests/build-new-dataset.py -f /opt/antinex-datasets/v2/malware/internetchemo/configs/convert-recordings-to-dataset.json

Confirm Dataset is Ready
------------------------

::

    /opt/antinex-datasets/tools/describe-v1-training.py /opt/antinex-datasets/v2/malware/internetchemo/training-ready/v2_malware_ic_cleaned.csv 

Hopefully your dataset has both attack and non-attack records like:

::

    TBD

What you don't want to see is this in the output:

::

    TBD

That means the prepare step failed to add the attack data into the dataset correctly. Please go back to the ``Prepare Dataset`` step and review paths to the files are correct.

Train Dataset
-------------

::

    source ~/.venvs/venvdrfpipeline/bin/activate
    ~/train-ai-with-django-swagger-jwt/tests/create-keras-dnn.py -f /opt/antinex-datasets/v2/malware/internetchemo/configs/train.json

From the logs taken during creation of this doc, the model is 70% accurate at predicting attack records.


Get the Deep Neural Network Accuracy, JSON and Weights
------------------------------------------------------

This will display all the recent training runs in a list sorted by newest.

::

    ~/train-ai-with-django-swagger-jwt/tests/get-recent-results.py 

Here's the training node in the list from the run above (yours will look a little different):

::

    TBD
